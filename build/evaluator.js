!function(e){var t="SPARK_modules";e[t]||(e[t]={},e.exportModule&&e.importModule||(e.exportModule=function(n,r){if(e[t][n])throw new Error("Module "+n+" already exists");e[t][n]=r},e.importModule=function(n){return e[t][n]},e.checkModule=function(n){return e[t].hasOwnProperty(n)}))}(this),function(e){var t="DEFAULT_CONSTANTS";if(!e.checkModule(t)){var n={LOW:{name:"LOW",type:"int",value:0},HIGH:{name:"HIGH",type:"int",value:1},READ:{name:"READ",type:"int",value:0},WRITE:{name:"WRITE",type:"int",value:1}};e.exportModule(t,n)}}(this),function(e){var t="ErrorManager";if(!e.checkModule(t)){var n={operator:{"+":"add","-":"subtract","*":"multiply","/":"divide"}},r={VARIABLE_STATEMENT:{type_mismatch:'variable "{0}" does not match type "{1}"',already_exists:'variable "{0}" was already initialized as {1} on line {2}',does_not_exist:'variable "{0}" is not defined'},VARIABLE_DECLARATOR:{already_initialized:'variable "{0}" was already initialized as {1} on line {2}',already_declared:'variable "{0}" was already declared on line {1}'},FUNCTION_DECLARATION:{already_exists:'function "{0}" was already declared on line {1}'},PARAM_DECLARATOR:{duplicate_param:'duplicate parameter "{0}"'},RETURN_STATEMENT:{return_outside:"return statement outside function declaration",type_mismatch:'return statement type does not match function "{0}"'},IDENTIFIER:{does_not_exist:'variable "{0}" does not exist'},BINARY_EXPRESSION:{type_mismatch:'"{0}" operation types do not match, can\'t {operator: 0} "{1}" and "{2}"'},LOGICAL_EXPRESSION:{type_mismatch:'can\'t compare "{0}" and "{1}"',cant_compare:'can\'t compare "{0}" and "{1}"',not_a_number:'can use "{0}" operator only on numbers'},ASSIGNMENT_STATEMENT:{type_mismatch:'assignment types mismatch, can\'t assign "{0}" to "{1}"'},UPDATE_EXPRESSION:{not_a_number:"expression is not a number"},UNARY_EXPRESSION:{not_a_bool:"unary expression must be a boolean"},IF_STATEMENT:{not_a_bool:"IF condition must be a boolean"}},o=function(e,t,o,a){var i="string"==typeof e?e:e.$$,u=r[i][o];if(a)for(var c=0,l=a.length;l>c;c++){var s=(a[c],new RegExp("\\{[ ]*([a-z]+)[ ]*\\:[ ]*"+c+"[ ]*\\}","gi")),p=new RegExp("\\{[ ]*"+c+"[ ]*\\}","gi");u=u.replace(s,function(e,t){var r=n[t];return console.log(">woo>"),console.log(e,t),r[a[c]]}),u=u.replace(p,a[c])}var f={error:{location:t,message:u,node:e}};return console.log(f.location),console.log(f.message),f},a={logError:o};e.exportModule(t,a)}}(this),function(e){var t="FuncTable";if(!e.checkModule(t)){var n={},r={node:null,returns:[]},o={getTable:function(){return n},reset:function(){n={},r={node:null,returns:[]}},getCurrentFunc:function(){return r},enterFunc:function(e){r.node=e},exitFunc:function(){r={node:null,returns:[]}},funcAddReturn:function(e){current.returns.push(e)},getSignature:function(e){for(var t=e.type+"__"+e.id.name+"__",n=0,r=e.params.length;r>n;n++)t+=e.params[n].type+"_";return t+="fn"},getParams:function(e){for(var t=[],n=0,r=e.length;r>n;n++){var o=e[n];t.push({type:o.type,name:o.id.name})}return t},findFunc:function(e){var t=o.getSignature(e);return n.hasOwnProperty(t)?n[t]:null},addFunc:function(e){var t=o.getSignature(e),r=e.id.name,a=e.type,i=o.getParams(e.params),u=e.location.start.line,c=e.doc?e.doc.body:"";n[t]={name:r,type:a,params:i,initLine:u,doc:c}}};e.exportModule(t,o)}}(this),function(e){var t="SymbolTable";if(!e.checkModule(t)){var n={},r=1,o={sc0:n,sc1:{}},a=o["sc"+r],i={setInitialScope:function(e){n=e,reset()},getTable:function(){return o},reset:function(){r=1,o={sc0:n,sc1:{}},a=o["sc"+r]},enterScope:function(){r+=1,o["sc"+r]={},a=o["sc"+r]},exitScope:function(){r>1&&(o["sc"+r]=null),r-=1,a=o["sc"+r]},getScope:function(e){var t=e||r;return o["sc"+t]},findSymbol:function(e){for(var t=r;t>=0;t--){var n=i.getScope(t);if(n.hasOwnProperty(e))return n[e]}return null},addSymbol:function(e,t){var n=t||e.init,r=e.id.name,o=n.value,i=n.type,u=e.location.start.line;a[r]={name:r,value:o,type:i,initLine:u}},checkScope:function(e){return a.hasOwnProperty(e)?a[e]:!1}};e.exportModule(t,i)}}(this),function(e){var t="EvaluatorUtil";if(!e.checkModule(t)){var n=["byte","int","long","float"],r=["==","!=","is","is not"],o={"byte":128,"int":32767,"long":2147483647},a={constructVarDeclarator:function(e){return e.$$="VARIABLE_STATEMENT",e.type=e.right.type,e.declarations=[{$$:"VARIABLE_DECLARATOR",id:{location:e.left.location,$$:"IDENTIFIER",name:e.left.name},location:e.left.location,init:e.right}],e},typeCheck:function(e,t){if(!e||!t)return!1;if(e===t)return e;var r=n.indexOf(e);if(r>-1){var o=n.indexOf(t);return o>-1?(o>r&&(e=t),e):!1}return!1},getParameters:function(e){},checkParamDuplicates:function(e){for(var t=1,n=e.length;n>t;t++)for(var r=e[t],o=0;t>o;o++){var a=e[o];if(a.id.name===r.id.name)return r}return!1},isNumber:function(e){return n.indexOf(e)>-1},isEqualityOperator:function(e){return r.indexOf(e)>-1},getIntegerType:function(e){var t=parseInt(e,10),n=Math.abs(t),r="int",a=o["long"];for(var i in o)if(o.hasOwnProperty(i)){var u=o[i];u>=n&&a>=u&&(r=i,a=u)}return r}};e.exportModule(t,a)}}(this);var theEvaluator=function(e){"use strict";var t=(e.importModule("DEFAULT_CONSTANTS"),e.importModule("SymbolTable")),n=e.importModule("FuncTable"),r=e.importModule("ErrorManager"),o=e.importModule("EvaluatorUtil"),a=function(e,t){var n=t||e.$$,r=u[n](e);if(r.error)throw new CompilerError("SemanticError",r.error.message,r.error.location);return r},i={parse:function(e,r){t.reset(),n.reset();var o=a(e);return console.log(t.getTable()),o}},u={DOCSTRING:function(e){return e},VARIABLE_STATEMENT:function(e){for(var n=e.type,i=0,u=e.declarations.length;u>i;i++){var c=e.declarations[i],l=null;if(null!==c.init){c.init=a(c.init);var s=o.typeCheck(e.type,c.init.type);if(!s)return r.logError(e,e.location,"type_mismatch",[c.id.name,n]);e.type=s,l=s}c.type=l;var p=c.id.name,f=t.checkScope(p);if(f)return r.logError(e,e.location,"already_exists",[c.id.name,f.value,f.initLine]);t.addSymbol(c,{value:null,type:e.type})}return e},VARIABLE_DECLARATOR:function(e){return e},FUNCTION_DECLARATION:function(e){var i=n.findFunc(e);if(i)return r.logError(e,e.location,"already_exists",[i.name,i.initLine]);var u=o.checkParamDuplicates(e.params);return u?r.logError(u,u.location,"duplicate_param",[u.id.name]):(n.addFunc(e),t.enterScope(),n.enterFunc(e),e.body=a(e.body),n.exitFunc(),t.exitScope(),e)},PARAM_DECLARATOR:function(e){return e},RETURN_STATEMENT:function(e){e.argument=a(e.argument),e.type=e.argument.type;var t=getCurrentFunc();if(!t.node)return r.logError(e,e.location,"return_outside");var n=o.typeCheck(e.type,t.type);return n?e:r.logError(e,e.location,"type_mismatch",[t.node.id.name])},CALL_STATEMENT:function(e){return e.type="int",e},FOR_STATEMENT:function(e){return e},FOR_STATEMENT_DECLARATION:function(e){return e},BREAK_STATEMENT:function(e){return e},CONTINUE_STATEMENT:function(e){return e},EXPRESSION_STATEMENT:function(e){var t=a(e.expression);return t},IDENTIFIER:function(e){var n=e.name,o=t.findSymbol(n);return o?(e.type=o.type,e):r.logError(e,e.location,"does_not_exist",[n])},LITERAL:function(e){return"int"===e.type&&(e.type=o.getIntegerType(e.value)),e},BINARY_EXPRESSION:function(e){return e.left=a(e.left),e.right=a(e.right),e.type=o.typeCheck(e.left.type,e.right.type),e.type?e:r.logError(e,e.location,"type_mismatch",[e.operator,e.left.type,e.right.type])},ASSIGNMENT_STATEMENT:function(e){e.right=a(e.right);var n=e.left.name,i=t.findSymbol(n);if(!i)return a(o.constructVarDeclarator(e));e.left=a(e.left);var u=o.typeCheck(e.left.type,e.right.type);return u?e:r.logError(e,e.location,"type_mismatch",[e.right.type,e.left.type])},BLOCK_STATEMENT:function(e){return t.enterScope(),e.body.forEach(function(e){e=a(e)}),t.exitScope(),e},PROGRAM:function(e){return e.body.forEach(function(e){e=a(e)}),e},IF_STATEMENT:function(e){return e.test=a(e.test),"bool"!==e.test.type?r.logError(e,e.test.location,"not_a_bool"):(e.consequent=a(e.consequent),e.alternate&&(e.alternate=a(e.alternate)),e)},LOGICAL_EXPRESSION:function(e){e.left=a(e.left),e.right=a(e.right);var t=o.typeCheck(e.left.type,e.right.type);return t?o.isEqualityOperator(e.operator)||o.isNumber(t)?e:r.logError(e,e.location,"not_a_number",[e.operator]):r.logError(e,e.location,"type_mismatch",[e.left.type,e.right.type])},UPDATE_EXPRESSION:function(e){return e.argument=a(e.argument),o.isNumber(e.argument.type)?(e.type=e.argument.type,e):r.logError(e,e.location,"not_a_number")},UNARY_EXPRESSION:function(e){e.argument=a(e.argument);var t=o.typeCheck(e.argument.type);return"bool"!==t?r.logError(e,e.location,"not_a_bool"):e}};return i}(this);
//# sourceMappingURL=maps/evaluator.js.map
